---
title: "Is Sustainable Development linked to Reduced Murder Rates?"
author: "Grace Damaschino, Tyler Lopez, Oriana Ramirez, Daniel Seiler"
self-contained: true
editor: source
format: 
  html:
    self-contained: true
    code-fold: true
    code-tools: true
    toc: true
execute: 
  echo: true
  warning: false
  message: false
  error: true
---

## Introduction

Our analysis will be on the relationship between the murder rate and the sustainability development index in multiple countries throughout the world. Two quantitative datasets titled Murders (per 100,000 people) and Sustainable Development Index were found on Gapminder. The Murders (per 100,000 people) dataset contains information on mortality per 100,000 people for 118 countries between 1949 to 2015. The mortality rate was adjusted by standard population and age so that all countries in the dataset have the same age composition of the population. The Sustainable Development Index dataset contains an efficiency metric for 165 countries between 1989 to 2018. The Sustainability Development Index (SDI) is a metric based on a Human Development Index (HDI) and an Ecological Impact Index. The human development index is the geometric mean of life expectancy, education, and modified income indices (Figure 1), while the ecological impact index (Figure 2) is based on the "extent to which consumption-based CO2 emissions and material footprint exceed per-capita shares of planetary boundaries" (Sustainable Development Index, 2019).

![](images/HDI.png){fig-align="center"}

Figure 1. HDI formula based on the geometric mean of life expectancy, education, and modified income indices. MYSI is the Mean Years of Schooling Index, EYSI is the Expected Years of Schooling Index, and GNI is Gross National Income (Methodology and Data, n.d.).

![](images/SDI.png){fig-align="center"}

Figure 2. Ecological Impact Index formula based on the Average Overshoot (AO) of material footprint (MF) and CO2 emissions.

### Hypothesis

We would hypothesize that the sustainability development index is strongly negatively correlated with murder rate, due to the wide variety of factors (as discussed above) that play into the sustainable development index. The sustainable development index is as much a measure of well-being and progress as it is sustainability, as a result of this we would expect a rise in murder rate to correspond with a drop in SDI. In terms of limitations of our regression model, we would also hypothesize that due to the wide net cast by the sustainable development index, there may be significant confounding variables or even possible redundancies limiting the applications of this analysis. For instance, SDI is calculated in large part from HDI, HDI incorporates life expectancy into their data, and a high murder rate would result in some reduction of life expectancy, thus reducing the SDI ranking directly.

## Data Selection and Manipulation

```{r setup}
#| message: FALSE
library(tidyverse)
library(here)
library(readr)
library(DT)
library(ggpubr)
library(patchwork)

#| message: FALSE
murder_RAW <- read_csv(here::here("murder_per_100000_people.csv"))
SDI_RAW <- read_csv(here::here("sdi.csv"))
```

```{r}
#Initial separate data treatment to adjust dataframes to the same column dimensions.

murder <- murder_RAW |> 
  select("country", "1989":"2006") |> 
  pivot_longer(cols = "1989":"2006",
               names_to = "year",
               values_to = "Murder Rate per 100K")|>
  mutate(year = as.numeric(year))

SDI <- SDI_RAW |> 
  select("country", "1989":"2006") |> 
  pivot_longer(cols = "1989":"2006",
               names_to = "year",
               values_to = "Sustainable Development Index")|>
  mutate(year = as.numeric(year))

#Both dataframes joined for further treatment.

data_RAW <- inner_join(murder, SDI)
```

```{r}
data_opt <- data_RAW |>
  group_by(country) |>
  mutate(NA_percent = sum(is.na(across("Murder Rate per 100K":"Sustainable Development Index")))/36) |>

# Remove all countries with more than 10% NAs
  filter(NA_percent < 0.1)
```

::: callout-warning

### Country Selection

Here is the list of eligible countries for analysis, spanning from 1989 to 2006 (the last year where the US has data). if we choose not to analyze the US, then this data set could be extended to the early/mid 2010s since most of these countries have datapoints in that time period.

```{r}
data_opt |> 
  distinct(country) |> 
  pull(country)
```
:::

```{r}
select_countries <- c("United States", "Australia", "Germany", "Singapore", "Japan")  # Final list of countries chosen for analysis
# 
data_clean <- data_opt |>
  filter(country %in% select_countries) |>
  select(country:"Sustainable Development Index")
datatable(data_clean, class = 'cell-border stripe', rownames = FALSE)
```

## Regression Analysis
### Data Visualization

```{r}
data_clean |>
  ggplot(aes(x = `Sustainable Development Index`, y = `Murder Rate per 100K`)) +
  geom_point(aes(color = fct_reorder(country, `Murder Rate per 100K`, .desc = TRUE))) +
  labs(x = "Sustainable Development Index (SDI)", y = "", subtitle = "Murder Rate per 100K", title = "Relationship between SDI and Murder Rate per 100k for 5 Countries") +
  guides(color = guide_legend(title = "Country"))
```

```{r}
fig.align = 'center' 

SDI_plot <- data_clean |>
  ggplot(aes(x = year, y = `Sustainable Development Index`)) +
  geom_point(aes(color = fct_reorder(country, `Murder Rate per 100K`, .desc = TRUE))) +
  labs(x = "Year", y = "", subtitle = "Sustainable Development Index \n(SDI)") +
  theme(legend.position = "none")

murder_plot <- data_clean |>
  ggplot(aes(x = year, y = `Murder Rate per 100K`)) +
  geom_point(aes(color = fct_reorder(country, `Murder Rate per 100K`, .desc = TRUE))) +
  labs(x = "Year", y = "", subtitle = "Murder Rate per 100K") +
  guides(color = guide_legend(title = "Country"))

SDI_plot + murder_plot
```

### Linear Regression
```{r}
#| fig-height: 16
totalcountry_lm <- lm(`Murder Rate per 100K` ~ `Sustainable Development Index`,
                    data = data_clean
                    )

data_us <- data_clean |>
  filter(country == "United States")
us_lm <- lm(`Murder Rate per 100K` ~ `Sustainable Development Index`,
                    data = data_us)

data_australia <- data_clean |>
  filter(country == "Australia")
australia_lm <- lm(`Murder Rate per 100K` ~ `Sustainable Development Index`,
                    data = data_australia)

data_germany <- data_clean |>
  filter(country == "Germany")
germany_lm <- lm(`Murder Rate per 100K` ~ `Sustainable Development Index`,
                    data = data_germany)

data_singapore <- data_clean |>
  filter(country == "Singapore")
singapore_lm <- lm(`Murder Rate per 100K` ~ `Sustainable Development Index`,
                    data = data_singapore)

data_japan <- data_clean |>
  filter(country == "Japan")
japan_lm <- lm(`Murder Rate per 100K` ~ `Sustainable Development Index`,
                    data = data_japan)

# United States plot ------------------------------ #
us_plot_lm <- data_us |> 
ggplot(aes(x = `Sustainable Development Index`, 
           y = `Murder Rate per 100K`)
       ) +
  geom_point(color = "#E76BF3") +
  geom_smooth(method = "lm",
              color = "black") + 
  labs(title = "United States",
       subtitle = "Murder Rate per 100K") + 
  theme(axis.title.y = element_blank(),
        plot.title.position = "plot") + 
  stat_regline_equation(label.x = -Inf, label.y = Inf, vjust = 1.5, hjust = -0.1, size = 3) + 
  stat_cor(label.x = -Inf, label.y = Inf, vjust = 3, hjust = -0.1, size = 3)


# Australia Plot ------------------------------ #
australia_plot_lm <- data_australia |> 
ggplot(aes(x = `Sustainable Development Index`, 
           y = `Murder Rate per 100K`)
       ) +
  geom_point(color = '#F8766D') +
  geom_smooth(method = "lm",
              color = 'black') + 
  labs(title = "Australia",
       subtitle = "Murder Rate per 100K") + 
  theme(axis.title.y = element_blank(),
        plot.title.position = "plot") + 
  stat_regline_equation(label.x = -Inf, label.y = Inf, vjust = 1.5, hjust = -0.1, size = 3) + 
  stat_cor(label.x = -Inf, label.y = Inf, vjust = 3, hjust = -0.1, size = 3)


# Germany Plot ------------------------------ #
germany_plot_lm <- data_germany |> 
ggplot(aes(x = `Sustainable Development Index`, 
           y = `Murder Rate per 100K`)
       ) +
  geom_point(color = '#A3A500') +
  geom_smooth(method = "lm",
              color = 'black') + 
  labs(title = 'Germany',
       subtitle = "Murder Rate per 100K") + 
  theme(axis.title.y = element_blank(),
        plot.title.position = "plot") + 
  stat_regline_equation(label.x = -Inf, label.y = Inf, vjust = 1.5, hjust = -0.1, size = 3) + 
  stat_cor(label.x = -Inf, label.y = Inf, vjust = 3, hjust = -0.1, size = 3)


# Singapore Plot ------------------------------ #
singapore_plot_lm <- data_singapore |> 
ggplot(aes(x = `Sustainable Development Index`, 
           y = `Murder Rate per 100K`)
       ) +
  geom_point(color = "#00B0F6") +
  geom_smooth(method = "lm",
              color = 'black') + 
  labs(title = 'Singapore',
       subtitle = "Murder Rate per 100K") + 
  theme(axis.title.y = element_blank(),
        plot.title.position = "plot") + 
  stat_regline_equation(label.x = -Inf, label.y = Inf, vjust = 1.5, hjust = -0.1, size = 3) + 
  stat_cor(label.x = -Inf, label.y = Inf, vjust = 3, hjust = -0.1, size = 3)


# Japan Plot ------------------------------ #
japan_plot_lm <- data_japan |> 
ggplot(aes(x = `Sustainable Development Index`, 
           y = `Murder Rate per 100K`)
       ) +
  geom_point(color = '#00BF7D') +
  geom_smooth(method = "lm",
              color = 'black') + 
  labs(title = 'Japan',
       subtitle = "Murder Rate per 100K") + 
  theme(axis.title.y = element_blank(),
        plot.title.position = "plot") + 
  stat_regline_equation(label.x = -Inf, label.y = Inf, vjust = 1.5, hjust = -0.1, size = 3) + 
  stat_cor(label.x = -Inf, label.y = Inf, vjust = 3, hjust = -0.1, size = 3)

# Total Country Plot ------------------------------ #
totalcountry_plot_lm <- data_clean |>
  ggplot(aes(x = `Sustainable Development Index`, 
           y = `Murder Rate per 100K`)
       ) +
  geom_point(aes(color = country)) +
  geom_smooth(method = "lm",
              color = 'black') + 
  labs(title = 'All Countries',
       subtitle = "Murder Rate per 100K") + 
  theme(axis.title.y = element_blank(),
        plot.title.position = "plot") + 
  stat_regline_equation(label.x = -Inf, label.y = Inf, vjust = 1.5, hjust = -0.1, size = 3) + 
  stat_cor(label.x = -Inf, label.y = Inf, vjust = 3, hjust = -0.1, size = 3)


us_plot_lm / australia_plot_lm / germany_plot_lm / singapore_plot_lm / japan_plot_lm / totalcountry_plot_lm

```

### Model Fit
```{r}
library(broom)
anova_table_us <- tidy(anova(us_lm))
anova_table_us_clean <- anova_table_us |>
  select(-statistic) |>
  rename("Response Variable US" = "term",
         "Degrees of Freedom" = "df",
         "Sum of Squares" = "sumsq",
         "Mean Squared Error" = "meansq",
         "P-Value" = "p.value") |>
  mutate(RMSE = sqrt(`Mean Squared Error`)) 



anova_table_singapore <- tidy(anova(singapore_lm))
anova_table_singapore_clean <- anova_table_singapore |>
  select(-statistic) |>
  rename("Response Variable Singapore" = "term",
         "Degrees of Freedom" = "df",
         "Sum of Squares" = "sumsq",
         "Mean Squared Error" = "meansq",
         "P-Value" = "p.value") |>
  mutate(RMSE = sqrt(`Mean Squared Error`)) 


anova_table_japan <- tidy(anova(japan_lm))
anova_table_japan_clean <- anova_table_japan |>
  select(-statistic) |>
  rename("Response Variable Japan" = "term",
         "Degrees of Freedom" = "df",
         "Sum of Squares" = "sumsq",
         "Mean Squared Error" = "meansq",
         "P-Value" = "p.value") |>
  mutate(RMSE = sqrt(`Mean Squared Error`)) 


anova_table_germany <- tidy(anova(germany_lm))
anova_table_germany_clean <- anova_table_germany |>
  select(-statistic) |>
  rename("Response Variable Germany" = "term",
         "Degrees of Freedom" = "df",
         "Sum of Squares" = "sumsq",
         "Mean Squared Error" = "meansq",
         "P-Value" = "p.value") |>
  mutate(RMSE = sqrt(`Mean Squared Error`)) 


anova_table_australia <- tidy(anova(australia_lm))
anova_table_australia_clean <- anova_table_australia |>
  select(-statistic) |>
  rename("Response Variable Australia" = "term",
         "Degrees of Freedom" = "df",
         "Sum of Squares" = "sumsq",
         "Mean Squared Error" = "meansq",
         "P-Value" = "p.value") |>
  mutate(RMSE = sqrt(`Mean Squared Error`)) 


anova_table_total <- tidy(anova(totalcountry_lm))
anova_table_total_clean <- anova_table_total |>
  select(-statistic) |>
  rename("Response Variable Total" = "term",
         "Degrees of Freedom" = "df",
         "Sum of Squares" = "sumsq",
         "Mean Squared Error" = "meansq",
         "P-Value" = "p.value") |>
  mutate(RMSE = sqrt(`Mean Squared Error`)) 

totalcountry_lm %>% 
  augment() %>% 
  ggplot(aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_hline(yintercept=0, linetype=2)+
  scale_y_continuous(limits=c(-8, 8))+
  labs(x="Fitted Values", y="", subtitle="Residuals", title="Residuals versus Fitted Values for Total Linear Regression")

us_lm %>% 
  augment() %>% 
  ggplot(aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_hline(yintercept=0, linetype=2)+
  scale_y_continuous(limits=c(-0.75, 0.75))+
  labs(x="Fitted Values", y="", subtitle="Residuals", title="Residuals versus Fitted Values for US Linear Regression")

australia_lm %>% 
  augment() %>% 
  ggplot(aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_hline(yintercept=0, linetype=2)+
  scale_y_continuous(limits=c(-0.5, 0.5))+
  labs(x="Fitted Values", y="", subtitle="Residuals", title="Residuals versus Fitted Values for Australia Linear Regression")

germany_lm %>% 
  augment() %>% 
  ggplot(aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_hline(yintercept=0, linetype=2)+
  scale_y_continuous(limits=c(-0.3, 0.3))+
  labs(x="Fitted Values", y="", subtitle="Residuals", title="Residuals versus Fitted Values for Germany Linear Regression")

singapore_lm %>% 
  augment() %>% 
  ggplot(aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_hline(yintercept=0, linetype=2)+
  scale_y_continuous(limits=c(-0.5, 0.5))+
  labs(x="Fitted Values", y="", subtitle="Residuals", title="Residuals versus Fitted Values for Singapore Linear Regression")

japan_lm %>% 
  augment() %>% 
  ggplot(aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_hline(yintercept=0, linetype=2)+
  scale_y_continuous(limits=c(-0.2, 0.2))+
  labs(x="Fitted Values", y="", subtitle="Residuals", title="Residuals versus Fitted Values for Japan Linear Regression")

```
```{r}
augment_total <- augment(totalcountry_lm)
augment_us <- augment(us_lm)
augment_aus <- augment(australia_lm)
augment_ger <- augment(germany_lm)
augment_sing <- augment(singapore_lm)
augment_jp <- augment(japan_lm)

Regression <- c("Total", "United States", "Australia", "Germany", "Singapore", "Japan")
Response_variability <- c(var(augment_total$`Sustainable Development Index`), var(augment_us$`Sustainable Development Index`), var(augment_aus$`Sustainable Development Index`), var(augment_ger$`Sustainable Development Index`), var(augment_sing$`Sustainable Development Index`), var(augment_jp$`Sustainable Development Index`))

Fitted_variability <- c(var(augment_total$.fitted), var(augment_us$.fitted), var(augment_aus$.fitted), var(augment_ger$.fitted), var(augment_sing$.fitted), var(augment_jp$.fitted))

residual_variability <- c(var(augment_total$.resid), var(augment_us$.resid), var(augment_aus$.resid), var(augment_ger$.resid), var(augment_sing$.resid), var(augment_jp$.resid))

Variability <- data.frame(Regression, Response_variability, Fitted_variability, residual_variability)

Column_names <- c("Regression Model", "Response Variance", "Fitted Variance", "Residual Variance")
library(kableExtra)
kable(x=Variability, col.names=Column_names) %>% 
  kable_classic_2()


```

# Discuss the proportion of the variability in the response values that was accounted for by your regression model. What does this suggest about the “quality” of your model?

The proportion of the variability in our response value (Murder Rate per 100K in these 5 countries) that is accounted for by our regression model (totalcountry_lm) is the resulting R-squared value of 0.0761. So, 7.61% of the variation in Murders per 100K people in these 5 countries can be explained by the Sustainable Development Index (SDI) for the countries, while the remaining 92.39% is due to other factors or random variation. This suggests that our model is low quality, and that the SDI does not explain the variability in Murders per 100K very well.

However...
Our residual variance for our totalcountry_lm is 7.62. This is the amount of unexplained variability in Murders that is not accounted for by SDI in the model. Since out Residual variance is 7.62, this indicates that the model is doing a better job of explaining the variability in the response variable.



## References:

Sustainable Development Index. (2019). Gapminder. <https://www.gapminder.org/data/> 

Methodology and Data. (n.d.). SUSTAINABLE DEVELOPMENT INDEX. <https://www.sustainabledevelopmentindex.org/methods.> 
